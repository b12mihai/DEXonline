<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    {include file="common/bits/css.ihtml" flex=1 lexemPicker=1}
    {include file="common/bits/js.ihtml" dex=1 lexemPicker=1}
    <title>DEX | Editare definiție</title>
  </head>

  <body>
    {assign var="title" value="Editare definiție: `$def->id`"}
    {include file="admin/header.ihtml"
             title="$title"}

    {include file="admin/recentlyVisited.ihtml"}

    {if $errorMessage}
      <table class="errorMessage">
        <tr><td>{$errorMessage}</td></tr>
      </table>
    {/if}

    <form action="definitionEdit.php" method="post">
      <input type="hidden" name="definitionId" value="{$def->id}"/>
      <table class="editableFields" id="lexemTable">
        <tr style="display:none">
          <td>Lexem:</td>
          <td>
            {include file="common/bits/lexemPicker.ihtml"
                     fieldName="lexemName[]"
                     submitName="lexemId[]"
                     dissociateLink="1"}
          </td>
        <tr>

        {foreach from=$lexems item=l}
          {if $l->description}
            {assign var="lexemName"
                    value="`$l->formNoAccent` (`$l->description`)"}
          {else}
            {assign var="lexemName" value="`$l->formNoAccent`"}
          {/if}
          <tr>
            <td>Lexem:</td>
            <td>
              {include file="common/bits/lexemPicker.ihtml"
                       displayValue="$lexemName"
                       fieldName="lexemName[]"
                       submitName="lexemId[]"
                       submitValue="`$l->id`"
                       editLinkId="`$l->id`"
                       dissociateLink="1"}
            </td>
          </tr>
        {/foreach}

        {foreach from=$homonyms item=h key=i}
          <tr>
            <td>
              <img src="{$imgRoot}/icons/error.png" alt="warning"/>
              Omonim:
            </td>
            <td>
              {include file="common/bits/lexemName.ihtml" lexem=$h}
              <a href="lexemEdit.php?lexemId={$h->id}">editează</a> |
              <a href="?definitionId={$def->id}&amp;associateLexemId={$h->id}">asociază</a>
            </td>
          </tr>
        {/foreach}
      </table>

      <a href="#" onclick="addLexemRow('lexemTable'); return false;">
        Adaugă un lexem
        {include file="admin/helpLink.ihtml" anchor="definitionAddLexem"}
      </a>
      <br/><br/>

      <table class="editableFields">
        <tr>
          <td>Sursa:</td>
          <td>
            {include file="common/sourceDropDown.ihtml"
                     sources=$allModeratorSources
                     src_selected=$def->sourceId
                     skipAnySource=true}
          </td>
        </tr>
        <tr>
          <td>
            Starea:
            {include file="admin/helpLink.ihtml" anchor="definitionDelete"}
          </td>
          <td>
            {include file="common/statusDropDown.ihtml"
                     name="status"
                     statuses=$allStatuses
                     selectedStatus=$def->status}
          </td>
        </tr>
        {if count($typos)}
          <tr>
            <td>Greșeli de tipar:</td>
            <td>
              {foreach from=$typos item=typo}
                <span class="typo">* {$typo->problem|escape}</span><br/>
              {/foreach}
            </td>
          </tr>
        {/if}
        <tr>
          <td>Conținut:</td>
          <td>
            <textarea name="internalRep" rows="15" cols="80"
            >{$def->internalRep|escape}</textarea>
          </td>
        </tr>
        <tr>
          <td>
            Comentariu<br/>
            (opțional):<br/>
            {include file="admin/helpLink.ihtml" anchor="definitionComment"}
          </td>
          <td>
            <textarea name="commentContents" rows="5" cols="80"
              >{$comment->contents|escape}</textarea>
          </td>
        </tr>
        <tr>
          <td colspan="3" class="buttonRow">
            <input type="submit" name="but_refresh" value="Reafișează"/>
            {include file="admin/helpLink.ihtml" anchor="definitionRefresh"}
            &nbsp;&nbsp;
            <input type="submit" name="but_accept" value="Acceptă"/>
            &nbsp;&nbsp;
            <input type="submit" name="but_move" value="Activează"/>
            {include file="admin/helpLink.ihtml" anchor="definitionActivate"}
          </td>
        </tr>
      </table>
    </form>

    <br/>
    {$def->htmlRep}<br/>
    <span class="defDetails">
      Id: {$def->id} |
      Sursa: {$source->shortName|escape} |
      Trimisă de {$user->nick|escape}, {$def->createDate|date_format:"%e %b %Y"} |
      {assign var=status value=`$def->status`}
      {assign var=statusName value=`$allStatuses[$status]`}
      Starea: {$statusName}
    </span>

    <br/><br/>
    Comentariu: {$comment->htmlContents}

  </body>
</html>
